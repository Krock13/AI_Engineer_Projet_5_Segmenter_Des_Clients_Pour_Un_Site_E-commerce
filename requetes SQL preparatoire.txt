SELECT c.customer_unique_id,
       julianday((SELECT MAX(order_purchase_timestamp) FROM orders)) - julianday(MAX(o.order_purchase_timestamp)) AS recency,
       COUNT(DISTINCT o.order_id) AS frequency,
       SUM(op.payment_value) AS total_spent,
       AVG(orev.review_score) AS avg_review_score,
       COUNT(DISTINCT oi.product_id) AS product_variety,
       GROUP_CONCAT(DISTINCT op.payment_type) AS payment_methods
FROM orders o
LEFT JOIN customers c ON o.customer_id = c.customer_id
LEFT JOIN order_pymts op ON o.order_id = op.order_id
LEFT JOIN (SELECT DISTINCT order_id, product_id FROM order_items) oi ON o.order_id = oi.order_id
LEFT JOIN order_reviews orev ON o.order_id = orev.order_id
GROUP BY c.customer_unique_id;